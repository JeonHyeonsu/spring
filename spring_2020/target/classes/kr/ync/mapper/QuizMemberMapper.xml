<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.ync.mapper.QuizMemberMapper">
   
   <sql id="criteria">
      <trim prefix="(" suffix=") AND " prefixOverrides="OR">
         <foreach item='type' collection="typeArr">
            <trim prefix="OR">
               <choose>
                  <when test="type == 'T'.toString()">
                     title like '%'||#{keyword}||'%'
                  </when>
                  <when test="type == 'C'.toString()">
                     content like '%'||#{keyword}||'%'
                  </when>
                  <when test="type == 'W'.toString()">
                     writer like '%'||#{keyword}||'%'
                  </when>
               </choose>
            </trim>
         </foreach>
      </trim>
   </sql>
   
   <select id="getList" resultType="kr.ync.domain.QuizMemberVO">
   <![CDATA[
      select * from member where id > 0 
      ]]>
   </select>
   
   <select id="getRank" resultType="kr.ync.domain.QuizMemberVO">
   <![CDATA[
      select * from member
      order by point desc
      ]]>
   </select>
   
   <select id="read" resultType="kr.ync.domain.QuizMemberVO">
      select * from member where id =   #{id}
   </select>
   
   <select id="view" resultType="kr.ync.domain.QuizMemberVO">
      select * from member where id =   #{id}
   </select>
   
   
   
   
   <insert id="insert">
      insert into member (id, pwd, username, email)
      values (#{id}, #{pwd}, #{username}, #{email})
   </insert>


   <delete id="delete">
      delete tbl_board where bno = #{bno}
   </delete>
 
   <update id="update">
      update member
      set id= #{id},
      username= #{username},
      email = #{email},
      profile_img = #{profile_img},
      profile = #{profile}
      
      where id =
      #{id}
   </update>
   
   <!-- <select id="getListWithPaging" resultType="kr.ync.domain.BoardVO">
      <![CDATA[
        SELECT   bno,
              title,
              content,
              writer,
              regdate,
              updatedate
      FROM   (SELECT /*+INDEX_DESC(tbl_board pk_board) */
                  rownum rn,
                  bno,
                  title,
                  content,
                  writer,
                  regdate,
                  updatedate
            FROM   tbl_board
            WHERE   rownum <= 20 
            )
      WHERE rn > 10   
      ]]>
   </select> -->
   <!-- 
   <select id="getListWithPaging" resultType="kr.ync.domain.BoardVO">
      <![CDATA[
        SELECT   bno,
              title,
              content,
              writer,
              regdate,
              updatedate
      FROM   (SELECT /*+INDEX_DESC(tbl_board pk_board) */
                  rownum rn,
                  bno,
                  title,
                  content,
                  writer,
                  regdate,
                  updatedate
            FROM   tbl_board
            WHERE   rownum <= #{pageNum} * #{amount}
            )
      WHERE rn > (#{pageNum} -1) * #{amount}
      ]]>
   </select>
    -->
   <!-- 
   <select id="getListWithPaging" resultType="kr.ync.domain.BoardVO">
      <![CDATA[
         SELECT   bno,
               title,
               content,
               writer,
               regdate,
               updatedate
         FROM   (SELECT /*+INDEX_DESC(tbl_board pk_board) */
                       rownum rn,
                       bno,
                       title,
                       content,
                       writer,
                       regdate,
                       updatedate 
               FROM   tbl_board
               WHERE
      ]]>   
               <trim prefix="(" suffix=") AND " prefixOverrides="OR">
                  <foreach item='type' collection="typeArr">
                     <trim prefix="OR">
                        <choose>
                           <when test="type == 'T'.toString()">
                              title like '%'||#{keyword}||'%'
                           </when>
                           <when test="type == 'C'.toString()">
                              content like '%'||#{keyword}||'%'
                           </when>
                           <when test="type == 'W'.toString()">
                              writer like '%'||#{keyword}||'%'
                           </when>
                        </choose>
                     </trim>
                  </foreach>
               </trim>
      <![CDATA[
               rownum <= #{pageNum} * #{amount}
                  )
         WHERE rn > (#{pageNum} -1) * #{amount}   
        ]]>
   </select>
    -->
   
   <!-- <select id="getListWithPaging" resultType="kr.ync.domain.RankVO">
      <![CDATA[
      SELECT   bno,
            title,
            content,
            writer,
            regdate,
            updatedate
      FROM   (SELECT /*+INDEX_DESC(tbl_board pk_board) */
                    rownum rn,
                    bno,
                    title,
                    content,
                    writer,
                    regdate,
                    updatedate 
               FROM   tbl_board
            WHERE 
        ]]>
        
      <include refid="criteria"></include> 
      
      <![CDATA[    
               rownum <= #{pageNum} * #{amount}
               )
        WHERE rn > (#{pageNum} -1) * #{amount}   
      ]]>
   </select>-->
   
   <select id="getListWithPaging" resultType="kr.ync.domain.RankVO">
      <![CDATA[
      SELECT	point,
				id,
				profile_img,
				rnk
	  FROM	(SELECT	ROWNUM rn,
					point,
					id,
					profile_img,
					rnk
			 FROM	(SELECT	POINT,
							ID, 
							profile_img,
							RANK() OVER (ORDER BY POINT DESC) AS rnk
					 FROM	MEMBER
					)
			 WHERE  rownum <= #{pageNum} * #{amount}
			)
        ]]>
      <include refid="criteria"></include> 
      
      <![CDATA[    
               
               
        WHERE rn > (#{pageNum} -1) * #{amount}   
      ]]>
   </select>
   
    
   <select id="getTotalCount" resultType="int">
      select count(*) from member where 
      
      <include refid="criteria"></include>
      
      <![CDATA[
      point > 0
      ]]>
   </select>

</mapper>